<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Project Setup</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" media="screen" href="/css/screen.css">
  </head>
  <body>
    <div class="container">
      <h1>Project Setup</h1>



<hr>

<div class="row">
  <div class="col-lg-3 col-md-3">
    <ul class="nav-toc"><li class="nav-toc-group"><a class="nav-toc-heading" href="/index.html">Home</a><ul class="nav-toc-menu"><li><a href="/intro/hello.html">Hello Macros</a></li></ul></li><li class="active nav-toc-group"><a class="nav-toc-heading" href="/setup/index.html">Project Setup</a><ul class="active nav-toc-menu"><li><a href="/setup/projects.html">Using Multiple Projects</a></li><li><a href="/setup/configurations.html">Using Multiple Configurations</a></li></ul></li><li class="nav-toc-group"><a class="nav-toc-heading" href="/asts/index.html">Constructing ASTs</a><ul class="nav-toc-menu"><li><a href="/asts/quasiquotes.html">Quasiquotes</a></li></ul></li><li class="nav-toc-group"><a class="nav-toc-heading" href="/types/index.html">Inspecting Types</a><ul class="nav-toc-menu"></ul></li><li class="nav-toc-group"><a class="nav-toc-heading" href="/debugging/index.html">Debugging Macros</a><ul class="nav-toc-menu"></ul></li></ul>
  </div>
  <div id="content" class="col-lg-9 col-md-9">
    <p>Organizing projects with macros can be difficult due to a restriction called <em>separate compilation</em>. <strong>Macros cannot be used in the same compilation unit as they are defined.</strong></p>

<h2 id="separate-compilation-in-sbt">Separate Compilation in SBT</h2>

<p>We can implement this in SBT by splitting code across multiple <em>projects</em> or <em>configurations</em>:</p>

<ul>
  <li>
    <p><a href="http://www.scala-sbt.org/0.13.2/docs/Getting-Started/Multi-Project.html">Projects</a> are the standard way of splitting a codebase. Typical use-cases include separating library code from application code, or re-using library code across multiple projects.</p>
  </li>
  <li>
    <p><a href="http://www.scala-sbt.org/0.12.1/docs/Dormant/Configurations.html">Configurations</a> are separate codebases within a project. <code>main</code> and <code>test</code> are examples of built-in configurations but we can equally define our own configurations.</p>
  </li>
</ul>

<p>In each case, SBT fulfills the requirement for separate compilation by compiling all of the code in one project or configuration before moving on to the next.</p>

<h2 id="practical-code-structure">Practical Code Structure</h2>

<p>When writing a library that uses macros, separate compilation means we tend to prefer one of two possible code structures. We either use macros as a thin layer on top of a non-macro codebase, or we use them as a fundemental underpinning for the rest of our code.</p>

<ul>
  <li>
    <p>Layering macros <em>on top</em> of the rest of our code means we don’t have to pay special attention to separate compilation. Our library code defines macros but doesn’t use them internally – any use cases occur in a separate project or in unit tests (which are in a separate configuration).</p>
  </li>
  <li>
    <p>Using macros <em>within</em> our library code requires us to split our codebase into multiple subprojects or configurations.</p>
  </li>
</ul>

<h2 id="macros-and-scala-versions">Macros and Scala Versions</h2>

<p>TODO: Using macros in Scala 2.10:
 - bring in quasiquotes via macro paradise;</p>

<p>TODO: Using macros in Scala 2.11:
 - no macro paradise.</p>


    <ul class="nav-pager"><li><a class="btn btn-primary" href="/intro/hello.html">&laquo; Prev</a></li><li><a class="btn btn-primary" href="/setup/projects.html">Next &raquo;</a></li></ul>
  </div>
</div>

      <script src="/js/site.js"></script>
    </div>
  </body>
</html>
